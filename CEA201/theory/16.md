# Chapter 16: Advanced Pipeline and Processor Organization / Ông lệnh nâng cao và Tổ chức bộ xử lý

## 16.1 Processor Requirements / Yêu cầu của bộ xử lý

*   **Fetch Instruction**: Read instruction from memory (register/cache/RAM).

    **Nạp lệnh**: Đọc lệnh từ bộ nhớ (thanh ghi, cache, hoặc RAM).
*   **Interpret Instruction**: Decode instruction to determine action.

    **Giải mã**: Phân tích lệnh để xác định hành động.
*   **Fetch Data**: May need to read from memory or I/O module.

    **Tải dữ liệu**: Có thể phải đọc dữ liệu từ bộ nhớ hoặc thiết bị I/O.
*   **Process Data**: Perform arithmetic/logic operations.

    **Xử lý dữ liệu**: Thực hiện phép toán số học/logic.
*   **Write Data**: Store result back to memory/I/O.

    **Ghi dữ liệu**: Ghi kết quả về bộ nhớ hoặc I/O.

## 16.2 Register Organization / Tổ chức thanh ghi

*   **Minimize memory access** by using registers for temporary storage.

    **Giảm truy cập bộ nhớ** bằng cách dùng thanh ghi làm nơi lưu tạm.
*   **Types of registers**:
    *   **User-visible**: General-purpose (data, address, condition).

        **Thấy được bởi người dùng**: Dữ liệu, địa chỉ, trạng thái.
    *   **Control/Status**: Internal control (PC, IR, MAR, MBR, PSW).

        **Điều khiển/trạng thái**: PC, IR, MAR, MBR, PSW.

## 16.3 Instruction Cycle / Chu kỳ lệnh

*   **Includes**: Fetch → Decode → Execute → Store.

    **Gồm các bước**: Nạp → Giải mã → Thực thi → Ghi.
*   **Includes optional Indirect Cycle** and **Interrupt Cycle**.

    **Có thể có thêm**: Chu kỳ gián tiếp và chu kỳ ngắt.

## 16.4 Instruction Pipelining / Ông lệnh xử lý lệnh

*   **Stages**:
    *   FI (Fetch Instruction): Đọc lệnh
    *   DI (Decode Instruction): Giải mã
    *   CO (Calculate Operand): Tính toán toán hạng
    *   FO (Fetch Operand): Tải toán hạng
    *   EI (Execute Instruction): Thực thi
    *   WO (Write Operand): Ghi kết quả
*   **Goal**: Overlap multiple instructions for performance.

    **Mục tiêu**: Gối lệnh để tăng tốc độ xử lý.

## 16.5 Pipeline Hazards / Rào cản trong pipeline

*   **Data Hazards**:
    *   RAW (Read After Write): Đọc trước khi ghi xong.
    *   WAR (Write After Read): Ghi trước khi đọc xong.
    *   WAW (Write After Write): Ghi không đúng thứ tự.
*   **Control Hazards** (branch hazards): Occur with wrong branch prediction.

    **Rào cản điều khiển**: Xảy ra nếu đoán nhánh sai.
*   **Solutions**:
    *   Branch prediction (predict taken/not taken).

        **Dự đoán nhánh**: đoán có nhảy hay không.
    *   Loop buffer, multiple streams.

        **Bộ đệm vòng lặp, luồng lệnh song song.**

## 16.6 Real-World Pipelines / Pipeline thực tế

*   **Intel 80486**: Có pipeline đa giai đoạn.

    **Có chiến lược dự đoán nhánh và nạp song song.**
*   **ARM Processor**:
    *   Load/store architecture.

        **Kiến trúc nạp/lưu.**
    *   Conditional execution to avoid branches.

        **Lệnh điều kiện giúp giảm nhánh.**
    *   Thumb (16-bit) and 32-bit unified format.

        **Hỗ trợ định dạng lệnh 16-bit và 32-bit.**

## 16.7 Interrupt Processing / Xử lý ngắt

*   **Interrupt Types**:
    *   Maskable, Nonmaskable, Exception, Software-generated.

        **Có thể che, không thể che, ngoại lệ, sinh bởi phần mềm.**
*   **Interrupt Vector Table**: Maps interrupt to address.

    **Bảng vector ngắt**: ánh xạ loại ngắt tới địa chỉ xử lý.
*   **ARM Interrupt Modes**: Separate registers and stacks.

    **Chế độ ngắt ARM**: Có thanh ghi và stack riêng biệt.